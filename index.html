<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeDoc - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>

    <style>
        :root {
            --bg-color: #1c1c1c;
            --card-bg: #2a2a2a; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            --accent-color: #f7a400; /* –ñ–µ–ª—Ç—ã–π –∞–∫—Ü–µ–Ω—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
            --border-radius-large: 30px;
            --border-radius-medium: 15px;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            padding: 2rem;
            text-align: center;
            width: 100%;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .auth-box {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 20px 30px;
            border-radius: var(--border-radius-large);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            max-width: 600px;
            width: 100%;
        }

        input[type="password"],
        input[type="text"] {
            flex-grow: 1;
            min-width: 200px;
            padding: 15px;
            border-radius: var(--border-radius-medium);
            border: none;
            background: #3a3a3a;
            color: white;
            font-size: 1.1em;
            outline: none;
        }
        input[type="password"]::placeholder,
        input[type="text"]::placeholder {
            color: #bbb;
        }

        button {
            padding: 15px 25px;
            background: var(--accent-color);
            border: none;
            border-radius: var(--border-radius-medium);
            color: #1c1c1c;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: background 0.2s, transform 0.2s;
        }
        button:hover {
            background: #fec147;
            transform: translateY(-2px);
        }

        /* –°–µ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* –¢—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ä—è–¥ */
            gap: 30px;
            width: 90%;
            max-width: 1200px;
            padding: 20px 0;
        }

        .doc-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-large);
            cursor: pointer;
            overflow: hidden;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            aspect-ratio: 16/10; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .doc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.6);
        }
        .doc-card img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å—é –∫–∞—Ä—Ç–æ—á–∫—É */
            border-radius: var(--border-radius-large);
        }
        .doc-card .doc-title {
            position: absolute;
            bottom: 15px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 15px;
            border-radius: var(--border-radius-medium);
            font-size: 1em;
            font-weight: bold;
            color: white;
        }


        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius-large);
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .modal-content h3 {
            margin-top: 0;
            font-size: 1.8em;
            color: var(--accent-color);
        }
        .modal-content input,
        .modal-content select {
            width: calc(100% - 30px);
            margin: 10px 0;
            padding: 15px;
            border-radius: var(--border-radius-medium);
            border: none;
            background: #3a3a3a;
            color: white;
            font-size: 1.1em;
            outline: none;
        }
        .modal-content button {
            margin: 15px 10px 0;
            width: calc(50% - 20px);
        }
        .modal-content button.cancel {
            background: #555;
            color: white;
        }

        /* –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ (Viewer) */
        .viewer-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            justify-content: center;
            align-items: center;
            z-index: 1500;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ */
        .doc-display {
            position: relative;
            background-color: transparent; /* –§–æ–Ω –¥–ª—è –±–ª–∏–∫–∞ */
            border-radius: var(--border-radius-large); /* –û–±—â–∏–µ –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏—è */
            overflow: hidden; /* –í–∞–∂–Ω–æ –¥–ª—è –±–ª–∏–∫–∞ */
            box-shadow: 0 0 15px rgba(0,0,0,0.8);
            transition: transform 0.5s ease-out;
            
            /* –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
            max-width: 90vw;
            max-height: 90vh;
            width: auto;
            height: auto;
        }
        
        .doc-display.passport { width: 600px; height: 420px; transform: rotate(90deg); }
        .doc-display.a4 { width: 600px; height: 840px; } /* –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã A4 */
        .doc-display.card { width: 400px; height: 250px; } /* –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã */

        /* –û–±–≤–æ–¥–∫–∞ –∏ –ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .doc-display::before,
        .doc-display::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: var(--border-radius-large);
            pointer-events: none;
        }
        .doc-display::before { /* –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞ */
            border: 1px solid white;
            z-index: 1;
        }
        .doc-display::after { /* –ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–π –±–ª–∏–∫ */
            border: 10px solid rgba(255, 255, 255, 0.15); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–∞–º–∫–∞ */
            z-index: 2;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        .doc-content {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius-large);
            overflow: hidden; /* –û–±—Ä–µ–∑–∞–µ–º, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ */
        }
        .doc-content img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute; /* –î–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö */
            top: 0; left: 0;
        }

        /* –ë–ª–∏–∫ –ø—Ä–∏ –Ω–∞–∫–ª–æ–Ω–µ (GLOW EFFECT) */
        .doc-glow {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at var(--glowX, 50%) var(--glowY, 50%), rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            opacity: var(--glowOpacity, 0);
            transition: opacity 0.1s ease-out;
            border-radius: var(--border-radius-large);
            pointer-events: none;
            z-index: 10; /* –ù–∞–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º, –Ω–æ –ø–æ–¥ —Ç–µ–∫—Å—Ç–æ–º */
        }

        /* –ù–∞–ª–æ–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        .data-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* –ß—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∫–ª–∏–∫–∞—Ç—å —Å–∫–≤–æ–∑—å */
            font-family: 'Roboto Mono', monospace; /* –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö */
            color: #333; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–µ */
            font-weight: bold;
            text-transform: uppercase;
        }
        .data-overlay div {
            position: absolute;
            white-space: nowrap; /* –ù–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Å—Ç—Ä–æ–∫—É */
        }

        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –ø–∞—Å–ø–æ—Ä—Ç–∞ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π, –ø–æ–≤–µ—Ä–Ω—É—Ç—ã–π) */
        .doc-display.passport .data-overlay .val-fio {
            top: 190px; left: 45px; /* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å */
            font-size: 11px;
            transform: rotate(-90deg); /* –ü–æ–≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç */
            transform-origin: top left;
        }
        .doc-display.passport .data-overlay .val-num {
            top: 360px; left: 190px; /* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å */
            font-size: 13px;
            color: #500;
            transform: rotate(-90deg); /* –ü–æ–≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç */
            transform-origin: top left;
        }

        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è A4 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
        .doc-display.a4 .data-overlay .val-fio { top: 200px; left: 100px; font-size: 16px; }
        .doc-display.a4 .data-overlay .val-num { top: 300px; left: 100px; font-size: 14px; }

        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .doc-display.card .data-overlay .val-fio { top: 80px; left: 50px; font-size: 12px; }
        .doc-display.card .data-overlay .val-num { top: 150px; left: 50px; font-size: 14px; }


        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏) */
        .img-passport { content: url('https://img.freepik.com/premium-photo/russian-passport-isolated-white-background_160606-444.jpg'); }
        .img-passport-inside { content: url('https://st3.depositphotos.com/10545222/15325/i/450/depositphotos_153251780-stock-photo-passport-of-the-russian-federation.jpg'); }
        .img-inn { content: url('https://bafybeif3uoy364z7x6f4m2x7w23z5s7aovv52t2x7w23z5s7aovv.ipfs.w3s.link/inn-example.jpg'); } /* –ü—Ä–∏–º–µ—Ä A4 */
        .img-snils { content: url('https://bafybeif47i434z7x6f4m2x7w23z5s7aovv52t2x7w23z5s7aovv.ipfs.w3s.link/snils-example.jpg'); } /* –ü—Ä–∏–º–µ—Ä A4 */
        .img-driver-license { content: url('https://bafybeif5uoy364z7x6f4m2x7w23z5s7aovv52t2x7w23z5s7aovv.ipfs.w3s.link/driver-license-example.jpg'); } /* –ü—Ä–∏–º–µ—Ä Card */
        .img-polis { content: url('https://bafybeif6uoy364z7x6f4m2x7w23z5s7aovv52t2x7w23z5s7aovv.ipfs.w3s.link/polis-example.jpg'); } /* –ü—Ä–∏–º–µ—Ä Card */
        .img-birth-cert { content: url('https://bafybeif7uoy364z7x6f4m2x7w23z5s7aovv52t2x7w23z5s7aovv.ipfs.w3s.link/birth-cert-example.jpg'); } /* –ü—Ä–∏–º–µ—Ä A4 */
        .img-marriage-cert { content: url('https://bafybeif8uoy364z7x6f4m2x7w23z5s7aovv52t2x7w23z5s7aovv.ipfs.w3s.link/marriage-cert-example.jpg'); } /* –ü—Ä–∏–º–µ—Ä A4 */

    </style>
</head>
<body>

    <div class="header">
        <h1>üîí –ú–æ–∏ –î–æ–∫—É–º–µ–Ω—Ç—ã</h1>
        <div class="auth-box">
            <input type="password" id="master-pass" placeholder="–ú–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å" oninput="app.loadDocs()">
            <button onclick="ui.showModal('add-modal')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div id="grid" class="grid"></div>

    <div id="add-modal" class="modal">
        <div class="modal-content">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</h3>
            <select id="doc-type-select">
                <option value="passport">–ü–∞—Å–ø–æ—Ä—Ç –†–§</option>
                <option value="inn">–ò–ù–ù</option>
                <option value="snils">–°–ù–ò–õ–°</option>
                <option value="driver_license">–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∞</option>
                <option value="polis">–ü–æ–ª–∏—Å –û–ú–°</option>
                <option value="birth_certificate">–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏</option>
                <option value="marriage_certificate">–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –±—Ä–∞–∫–µ</option>
            </select>
            <input type="text" id="in-fio" placeholder="–§–ò–û –ø–æ–ª–Ω–æ—Å—Ç—å—é">
            <input type="text" id="in-num" placeholder="–°–µ—Ä–∏—è –∏ –Ω–æ–º–µ—Ä / –î–∞–Ω–Ω—ã–µ">
            <button onclick="app.saveDoc()">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="cancel" onclick="ui.hideModal('add-modal')">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="viewer" class="viewer-overlay" onclick="app.closeViewer()">
        <div id="doc-display" class="doc-display">
            <div class="doc-content">
                <img id="doc-main-img" src="" alt="–î–æ–∫—É–º–µ–Ω—Ç">
                <div class="data-overlay">
                    <div id="out-fio" class="val-fio"></div>
                    <div id="out-num" class="val-num"></div>
                </div>
            </div>
            <div class="doc-glow" id="doc-glow"></div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
        const db = new Dexie("SecureDocsDB");
        db.version(1).stores({ documents: '++id, type, data' });

        // –°–ª–æ–≤–∞—Ä—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        const docTemplates = {
            passport: { 
                title: '–ü–∞—Å–ø–æ—Ä—Ç –†–§', 
                cover: 'img-passport', 
                inside: 'img-passport-inside', 
                class: 'passport',
                fioPos: { top: '190px', left: '45px', fontSize: '11px', rotate: '-90deg' },
                numPos: { top: '360px', left: '190px', fontSize: '13px', rotate: '-90deg' }
            },
            inn: { 
                title: '–ò–ù–ù', 
                cover: 'img-inn', 
                inside: 'img-inn', 
                class: 'a4',
                fioPos: { top: '200px', left: '100px', fontSize: '16px' },
                numPos: { top: '300px', left: '100px', fontSize: '14px' }
            },
            snils: { 
                title: '–°–ù–ò–õ–°', 
                cover: 'img-snils', 
                inside: 'img-snils', 
                class: 'a4',
                fioPos: { top: '180px', left: '150px', fontSize: '15px' },
                numPos: { top: '250px', left: '150px', fontSize: '14px' }
            },
            driver_license: { 
                title: '–í–æ–¥. –ø—Ä–∞–≤–∞', 
                cover: 'img-driver-license', 
                inside: 'img-driver-license', 
                class: 'card',
                fioPos: { top: '100px', left: '60px', fontSize: '12px' },
                numPos: { top: '170px', left: '60px', fontSize: '14px' }
            },
            polis: { 
                title: '–ü–æ–ª–∏—Å –û–ú–°', 
                cover: 'img-polis', 
                inside: 'img-polis', 
                class: 'card',
                fioPos: { top: '90px', left: '50px', fontSize: '12px' },
                numPos: { top: '140px', left: '50px', fontSize: '14px' }
            },
            birth_certificate: { 
                title: '–°–≤-–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏', 
                cover: 'img-birth-cert', 
                inside: 'img-birth-cert', 
                class: 'a4',
                fioPos: { top: '220px', left: '120px', fontSize: '16px' },
                numPos: { top: '350px', left: '120px', fontSize: '14px' }
            },
            marriage_certificate: { 
                title: '–°–≤-–≤–æ –æ –±—Ä–∞–∫–µ', 
                cover: 'img-marriage-cert', 
                inside: 'img-marriage-cert', 
                class: 'a4',
                fioPos: { top: '250px', left: '100px', fontSize: '16px' },
                numPos: { top: '400px', left: '100px', fontSize: '14px' }
            }
            // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å—é–¥–∞
        };

        const ui = {
            showModal: (id) => document.getElementById(id).style.display = 'flex',
            hideModal: (id) => document.getElementById(id).style.display = 'none',
        };

        const app = {
            // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
            encrypt: (text, key) => CryptoJS.AES.encrypt(text, key).toString(),
            decrypt: (cipher, key) => {
                try {
                    const bytes = CryptoJS.AES.decrypt(cipher, key);
                    return bytes.toString(CryptoJS.enc.Utf8);
                } catch(e) { return null; }
            },

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            async saveDoc() {
                const pass = document.getElementById('master-pass').value;
                if (!pass) return alert("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å!");

                const docType = document.getElementById('doc-type-select').value;
                const data = {
                    fio: document.getElementById('in-fio').value,
                    num: document.getElementById('in-num').value
                };

                const encrypted = this.encrypt(JSON.stringify(data), pass);
                await db.documents.add({ type: docType, data: encrypted });
                
                ui.hideModal('add-modal');
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                document.getElementById('in-fio').value = '';
                document.getElementById('in-num').value = '';
                this.loadDocs();
            },

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Å–µ—Ç–∫–µ
            async loadDocs() {
                const pass = document.getElementById('master-pass').value;
                const grid = document.getElementById('grid');
                grid.innerHTML = '';

                const items = await db.documents.toArray();
                
                items.forEach(item => {
                    const docInfo = docTemplates[item.type];
                    if (!docInfo) return; // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–∏–ø—ã

                    const el = document.createElement('div');
                    el.className = 'doc-card';
                    el.innerHTML = `
                        <img class="${docInfo.cover}">
                        <span class="doc-title">${docInfo.title}</span>
                    `;
                    el.onclick = () => this.openViewer(item.type, item.data, pass);
                    grid.appendChild(el);
                });
            },

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞
            openViewer(docType, encryptedData, pass) {
                const decrypted = this.decrypt(encryptedData, pass);
                if (!decrypted) return alert("–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å.");

                const data = JSON.parse(decrypted);
                const docInfo = docTemplates[docType];
                if (!docInfo) return;

                const viewer = document.getElementById('viewer');
                const docDisplay = document.getElementById('doc-display');
                const docImg = document.getElementById('doc-main-img');
                const outFio = document.getElementById('out-fio');
                const outNum = document.getElementById('out-num');

                // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ —Å—Ç–∏–ª–µ–π
                docDisplay.className = 'doc-display';
                outFio.style = '';
                outNum.style = '';

                // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤
                docDisplay.classList.add(docInfo.class);
                docImg.className = docInfo.inside; // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —á–∞—Å—Ç–∏

                outFio.innerText = data.fio;
                outNum.innerText = data.num;

                // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
                Object.assign(outFio.style, {
                    top: docInfo.fioPos.top,
                    left: docInfo.fioPos.left,
                    fontSize: docInfo.fioPos.fontSize,
                    transform: docInfo.fioPos.rotate ? `rotate(${docInfo.fioPos.rotate})` : ''
                });
                Object.assign(outNum.style, {
                    top: docInfo.numPos.top,
                    left: docInfo.numPos.left,
                    fontSize: docInfo.numPos.fontSize,
                    color: docInfo.numPos.color || '#333',
                    transform: docInfo.numPos.rotate ? `rotate(${docInfo.numPos.rotate})` : ''
                });
                
                viewer.style.display = 'flex';
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±–ª–∏–∫–∞
                app.activateGlowEffect();
            },

            closeViewer() {
                document.getElementById('viewer').style.display = 'none';
                // –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–ª–∏–∫–∞
                app.deactivateGlowEffect();
            },

            // –≠—Ñ—Ñ–µ–∫—Ç –±–ª–∏–∫–∞ –ø—Ä–∏ –Ω–∞–∫–ª–æ–Ω–µ
            activateGlowEffect() {
                const docDisplay = document.getElementById('doc-display');
                const docGlow = document.getElementById('doc-glow');
                let isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);

                if (window.DeviceOrientationEvent && isMobile) {
                    let timeout;
                    const handleOrientation = (event) => {
                        clearTimeout(timeout); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤

                        // Gamma (left-right) -90 to 90, Beta (front-back) -180 to 180
                        const gamma = event.gamma; // [-90, 90]
                        const beta = event.beta;   // [-180, 180]

                        // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 100] –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                        let x = ((gamma + 90) / 180) * 100;
                        let y = ((beta + 180) / 360) * 100;

                        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ/–ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏–ª–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                        // –ó–¥–µ—Å—å –º–æ–≥—É—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞: –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Y –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                        y = 100 - y; 

                        docGlow.style.setProperty('--glowX', `${x}%`);
                        docGlow.style.setProperty('--glowY', `${y}%`);
                        docGlow.style.setProperty('--glowOpacity', '1');

                        // –ó–∞—Ç—É—Ö–∞–Ω–∏–µ –±–ª–∏–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è
                        timeout = setTimeout(() => {
                            docGlow.style.setProperty('--glowOpacity', '0');
                        }, 500); // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–∏–∫ —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã –±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è
                    };

                    window.addEventListener('deviceorientation', handleOrientation);
                    docDisplay._orientationHandler = handleOrientation; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                } else {
                    // –ï—Å–ª–∏ –Ω–µ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–∏–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É
                    docGlow.style.setProperty('--glowX', '50%');
                    docGlow.style.setProperty('--glowY', '50%');
                    docGlow.style.setProperty('--glowOpacity', '0.7');
                }
            },

            deactivateGlowEffect() {
                const docDisplay = document.getElementById('doc-display');
                const docGlow = document.getElementById('doc-glow');
                if (docDisplay._orientationHandler) {
                    window.removeEventListener('deviceorientation', docDisplay._orientationHandler);
                    docDisplay._orientationHandler = null;
                }
                docGlow.style.setProperty('--glowOpacity', '0');
            }
        };

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ DeviceOrientation, –µ—Å–ª–∏ —ç—Ç–æ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            console.log('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä –ø–æ–ª—É—á–µ–Ω–æ.');
                        }
                    })
                    .catch(console.error);
            }
            app.loadDocs();
        });

    </script>
</body>
</html>
